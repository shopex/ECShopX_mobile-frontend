"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_get=function e(t,r,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in a)return a.value;var i=a.get;return void 0!==i?i.call(n):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../api/index.js"),_index4=_interopRequireDefault(_index3),_index5=require("../../utils/index.js"),_index6=require("../../spx/index.js"),_index7=_interopRequireDefault(_index6),_qiniu=require("../../utils/qiniu.js"),_qiniu2=_interopRequireDefault(_qiniu);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(o,i){return function t(e,r){try{var n=s[e](r),a=n.value}catch(e){return void i(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});o(a)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var TradeRefund=(_temp2=_class=function(e){function o(){var e,t,g,h=this;_classCallCheck(this,o);for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=g=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(n)))).$usedState=["loopArray0","curSegIdx","segTypes","reason","description","imgs","curReasonIdx","goodStatus","curGoodIdx","isShowSegGoodSheet","isSameCurSegGood","curSegGoodValue","isShowSegTypeSheet","isSameCurSegType","curSegTypeValue"],g.handleClickTag=function(e){var t=g.state.reason.indexOf(e.name);0<=t&&g.setState({curReasonIdx:t})},g.handleTextChange=function(e){var t=e.target.value;g.setState({description:t})},g.handleImageChange=function(e,t){if("remove"!==t){3<e.length&&_index7.default.toast("最多上传3张图片");var r=e.slice(0,3);_qiniu2.default.uploadImageFn(r,"/espier/image_upload_token","qiniu","aftersales").then(function(e){g.setState({imgs:e})})}else g.setState({imgs:e})},g.handleImageClick=function(){},g.handleClickTab=function(e){g.setState({curSegIdx:e})},g.handleChangeRefundOptions=function(e){"type"===e&&g.setState({isShowSegTypeSheet:!0}),"goods"===e&&g.setState({isShowSegGoodSheet:!0})},g.handleClickSheet=function(e,t,r){"type"===r&&g.setState({curSegIdx:e===g.state.curSegIdx?null:e,isSameCurSegType:e!==g.state.curSegIdx||!g.state.isSameCurSegType,isShowSegTypeSheet:!1,curSegTypeValue:e===g.state.curSegIdx?null:t.value}),"goods"===r&&g.setState({curGoodIdx:e===g.state.curGoodIdx?null:e,isSameCurSegGood:e!==g.state.curGoodIdx||!g.state.isSameCurSegGood,isShowSegGoodSheet:!1,curSegGoodValue:e===g.state.curGoodIdx?null:t})},g.handleSubmit=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a,o,i,s,u,c,d,l,p,f,_;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=g.state,r=t.segTypes,n=t.curSegIdx,a=t.curReasonIdx,o=t.description,i=g.state.reason[a],s=r[n].status,u=g.state.imgs.map(function(e){return e.url}),c=g.$router.params,d=c.item_id,l=c.order_id,p=c.aftersales_bn,f={item_id:d,order_id:l,aftersales_bn:p,aftersales_type:s,reason:i,description:o,evidence_pic:u},_=p?"modify":"apply",e.next=9,_index4.default.aftersales[_](f);case 9:_index7.default.toast("操作成功");case 10:case"end":return e.stop()}},e,h)})),g.$$refs=[],_possibleConstructorReturn(g,t)}var t;return _inherits(o,_index.Component),_createClass(o,[{key:"_constructor",value:function(e){_get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"_constructor",this).call(this,e),this.state={description:"",imgs:[],reason:["物流破损","产品描述与实物不符","质量问题","皮肤过敏"],curReasonIdx:null,goodStatus:["未收到货","已收到货"],curGoodIdx:null,isShowSegGoodSheet:!1,isSameCurSegGood:!1,curSegGoodValue:null,segTypes:[{title:"仅退款",status:"ONLY_REFUND"},{title:"退货退款",status:"REFUND_GOODS"}],curSegIdx:0,isShowSegTypeSheet:!1,isSameCurSegType:!1,curSegTypeValue:null}}},{key:"componentDidMount",value:function(){this.fetch()}},{key:"fetch",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a,o,i,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return _index2.default.showLoading({mask:!0}),t=this.$router.params,r=t.aftersales_bn,n=t.item_id,a=t.order_id,e.next=4,_index4.default.aftersales.info({aftersales_bn:r,item_id:n,order_id:a});case 4:if(o=e.sent,_index2.default.hideLoading(),o.aftersales){e.next=8;break}return e.abrupt("return");case 8:i=(0,_index5.pickBy)(o.aftersales,{curSegIdx:function(e){var t=e.aftersales_type;return s.state.segTypes.findIndex(function(e){return e.status===t})||0},curSegTypeValue:function(e){var t=e.aftersales_type;return s.state.segTypes[s.state.segTypes.findIndex(function(e){return e.status===t})].title},curReasonIdx:function(e){var t=e.reason;return s.state.reason.indexOf(t)||0},curSegReasonValue:"reason",description:"description",imgs:function(e){return e.evidence_pic.map(function(e){return{url:e}})}}),this.setState(i);case 10:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=this.__state,t=(e.segTypes,e.curSegIdx,e.reason),r=e.curReasonIdx,n=(e.goodStatus,e.curGoodIdx,e.isShowSegGoodSheet,e.isSameCurSegGood,e.curSegGoodValue,e.description,e.imgs,t.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp2:(0,_index5.classNames)("refund-reason",t===r?"refund-reason__checked":""),$original:e.$original}}));return Object.assign(this.__state,{loopArray0:n}),this.__state}}]),o}(),_class.properties={},_class.$$events=["handleClickTab","handleClickTag","handleTextChange","handleImageChange","handleImageClick","handleSubmit"],_temp2);exports.default=TradeRefund,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(TradeRefund,!0));