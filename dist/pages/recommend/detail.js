"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_class2,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_get=function e(t,n,r){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(r):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../api/index.js"),_index4=_interopRequireDefault(_index3),_index5=require("../../hocs/index.js"),_index6=require("../../utils/index.js"),_index7=require("../../spx/index.js"),_index8=_interopRequireDefault(_index7);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){return function t(e,n){try{var r=s[e](n),a=r.value}catch(e){return void o(e)}if(!r.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});i(a)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var recommendDetail=(0,_index5.withPager)((_temp2=_class2=function(e){function c(){var e,t,o,n,s=this;_classCallCheck(this,c);for(var r=arguments.length,a=Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=o=_possibleConstructorReturn(this,(e=c.__proto__||Object.getPrototypeOf(c)).call.apply(e,[this].concat(a)))).$usedState=["anonymousState__temp","info","praiseCheckStatus","collectArticleStatus","item_id_List"],o.praiseCheck=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_index8.default.getAuthToken()){e.next=2;break}return e.abrupt("return",!1);case 2:return t=o.$router.params.id,e.next=5,_index4.default.article.praiseCheck(t);case 5:n=e.sent,r=n.status,o.setState({praiseCheckStatus:r});case 8:case"end":return e.stop()}},e,s)})),o.handleClickBar=(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.$router.params.id,"like"===t)return e.next=4,_index4.default.article.praise(n);e.next=8;break;case 4:r=e.sent,r.count,o.praiseCheck(),o.fetchContent();case 8:if("mark"===t)return e.next=11,_index4.default.article.collectArticle(n);e.next=23;break;case 11:if(!(a=e.sent).fav_id||!1!==o.state.collectArticleStatus){e.next=17;break}o.setState({collectArticleStatus:!0}),_index2.default.showToast({title:"已加入心愿单",icon:"none"}),e.next=22;break;case 17:return i={article_id:n},e.next=20,_index4.default.article.delCollectArticle(i);case 20:o.setState({collectArticleStatus:!1}),_index2.default.showToast({title:"已移出心愿单",icon:"none"});case 22:console.log(a,62);case 23:case"end":return e.stop()}},e,s)})),function(e){return n.apply(this,arguments)}),o.handleToGiftMiniProgram=function(){_index2.default.navigateToMiniProgram({appId:"wx2fb97cb696f68d22",path:"/pages/index/index",success:function(e){console.log(e)}})},o.$$refs=[],_possibleConstructorReturn(o,t)}var t,n;return _inherits(c,_index.Component),_createClass(c,[{key:"_constructor",value:function(e){(e=e||{}).pageSize=50,_get(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"_constructor",this).call(this,e),this.state=_extends({},this.state,{info:null,praiseCheckStatus:!1,collectArticleStatus:!1,item_id_List:[]})}},{key:"componentDidShow",value:function(){this.fetchContent(),this.praiseCheck()}},{key:"componentDidMount",value:function(){}},{key:"fetch",value:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,a,i,o,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.page_no,t.page_size,r={page:n,pageSize:50,item_type:"normal",item_id:this.state.item_id_List},e.next=4,_index4.default.item.search(r);case 4:return a=e.sent,i=a.list,o=a.total_count,i.map(function(t){"onsale"===t.approve_status&&(s.state.info.content.map(function(e){"goods"===e.name&&e.data.map(function(e){t.item_id===e.item_id&&(e.isOnsale=!0)})}),s.setState({info:s.state.info}))}),_index2.default.hideLoading(),e.abrupt("return",{total:o});case 10:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"fetchContent",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.$router.params.id,e.next=3,_index4.default.article.focus(t);case 3:if(n=e.sent,_index8.default.getAuthToken())return e.next=7,_index4.default.article.delCollectArticleInfo({article_id:t});e.next=9;break;case 7:0===e.sent.length?this.setState({collectArticleStatus:!1}):this.setState({collectArticleStatus:!0});case 9:if(!n){e.next=22;break}if(_index8.default.getAuthToken())return e.next=13,_index4.default.article.authDetail(t);e.next=16;break;case 13:e.t0=e.sent,e.next=19;break;case 16:return e.next=18,_index4.default.article.detail(t);case 18:e.t0=e.sent;case 19:(r=e.t0).updated_str=(0,_index6.formatTime)(1e3*r.updated,"YYYY-MM-DD"),this.setState({info:r},function(){_index2.default.showLoading();var t=[];r.content&&(r.content.map(function(e){"goods"===e.name&&e.data.map(function(e){t.push(e.item_id)})}),a.setState({item_id_List:t},function(){a.resetPage(),setTimeout(function(){a.nextPage()},200)}))});case 22:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"handleShare",value:function(){}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=this.__state,t=e.info,n=(e.praiseCheckStatus,e.collectArticleStatus,e.showBackToTop);if(!t)return null;var r=!n;return Object.assign(this.__state,{anonymousState__temp:r}),this.__state}}]),c}(),_class2.properties={},_class2.$$events=["handleToGiftMiniProgram","handleShare","scrollBackToTop","handleClickBar"],_class=_temp2))||_class;exports.default=recommendDetail,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(recommendDetail,!0));