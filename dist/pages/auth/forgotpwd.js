"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_get=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in o)return o.value;var i=o.get;return void 0!==i?i.call(n):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../spx/index.js"),_index4=_interopRequireDefault(_index3),_index5=require("../../api/index.js"),_index6=_interopRequireDefault(_index5);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,i){return function t(e,r){try{var n=s[e](r),o=n.value}catch(e){return void i(e)}if(!n.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});a(o)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Forgotpwd=(_temp2=_class=function(e){function c(){var e,t,s,r,n,u=this;_classCallCheck(this,c);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return(t=s=_possibleConstructorReturn(this,(e=c.__proto__||Object.getPrototypeOf(c)).call.apply(e,[this].concat(a)))).$usedState=["info","imgVisible","imgInfo","timerMsg","isVisible"],s.handleClickImgcode=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={type:"forgot_password"},e.prev=1,e.next=4,_index6.default.user.regImg(t);case 4:r=e.sent,s.setState({imgInfo:r}),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,u,[[1,8]])})),s.handleSubmit=(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.detail.value,(n=_extends({},s.state.info,r)).mobile&&/1\d{10}/.test(n.mobile)){e.next=4;break}return e.abrupt("return",_index4.default.toast("请输入正确的手机号"));case 4:if(n.vcode){e.next=6;break}return e.abrupt("return",_index4.default.toast("请选择验证码"));case 6:if(n.password){e.next=8;break}return e.abrupt("return",_index4.default.toast("请输入密码"));case 8:return console.log(n,19),e.prev=9,e.next=12,_index6.default.user.forgotPwd(n);case 12:_index2.default.showToast({title:"修改成功",icon:"none"}),setTimeout(function(){_index2.default.redirectTo({url:"/pages/auth/wxauth"})},700),e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(9),e.abrupt("return",!1);case 20:case"end":return e.stop()}},e,u,[[9,16]])})),function(e){return n.apply(this,arguments)}),s.handleChange=function(e,t){s.state.info[e]=t,"mobile"===e&&11===t.length&&0===s.count&&(s.count=1,s.setState({imgVisible:!0}))},s.handleClickIconpwd=function(){var e=s.state.isVisible;s.setState({isVisible:!e})},s.handleErrorToastClose=function(){_index4.default.closeToast()},s.handleTimerStart=(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s.state.isTimerStart)return e.abrupt("return");e.next=2;break;case 2:if(r=s.state.info,n=r.mobile,o=r.yzm,a=s.state.imgInfo,/1\d{10}/.test(n)){e.next=6;break}return e.abrupt("return",_index4.default.toast("请输入正确的手机号"));case 6:if(11===n.length&&o){e.next=8;break}return e.abrupt("return",_index4.default.toast("请输入手机号和图形验证码"));case 8:return i={type:"forgot_password",mobile:n,yzm:o,token:a.imageToken},e.prev=9,e.next=12,_index6.default.user.regSmsCode(i);case 12:_index4.default.toast("发送成功"),e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(9),e.abrupt("return",!1);case 19:t();case 20:case"end":return e.stop()}},e,u,[[9,15]])})),function(e){return r.apply(this,arguments)}),s.handleUpdateTimer=function(e){var t=e+"s";s.setState({timerMsg:t})},s.handleTimerStop=function(){s.setState({timerMsg:"重新获取"})},s.$$refs=[],_possibleConstructorReturn(s,t)}var t;return _inherits(c,_index.Component),_createClass(c,[{key:"_constructor",value:function(e){_get(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"_constructor",this).call(this,e),this.state={info:{},timerMsg:"获取验证码",isVisible:!1,imgVisible:!1,imgInfo:{}}}},{key:"componentDidMount",value:function(){this.fetch()}},{key:"fetch",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.handleClickImgcode(),this.count=0;case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=this.__state;e.info,e.timerMsg,e.isVisible,e.imgVisible,e.imgInfo;return Object.assign(this.__state,{}),this.__state}}]),c}(),_class.properties={},_class.$$events=["handleSubmit","handleErrorToastClose","handleChange","handleClickImgcode","handleTimerStart","handleUpdateTimer","handleTimerStop","handleClickIconpwd"],_temp2);exports.default=Forgotpwd,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Forgotpwd,!0));