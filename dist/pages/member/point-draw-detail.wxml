<block>
    <block wx:if="{{!info}}">
        <loading __triggerObserer="{{ _triggerObserer }}"></loading>
    </block>
    <view class="page-goods-detail" wx:else>
        <nav-bar title="{{info.goods_info.itemName}}" __triggerObserer="{{ _triggerObserer }}" leftIconType="chevron-left" fixed="true"></nav-bar>
        <scroll-view class="goods-detail__wrap" scroll-y="{{true}}" scroll-top="{{scrollTop}}" scroll-with-animation="{{true}}" bindscroll="handleScroll">
            <block wx:if="{{info.open_status === 'success'}}">
                <view class="lucky__wrap">
                    <view class="lucky__wrap-info">
                        <view class="lucky__wrap-info-item lucky__wrap-info-img">
                            <image mode="aspectFill" src="{{luckyInfo.avatar}}" class="luck-avator"></image><text class="luck-phone">{{luckyInfo.mobile}}</text><text class="luck-title">中奖者</text>
                        </view>
                        <view class="lucky__wrap-info-item"><text class="item-name">总共购买</text><text>{{luckyInfo.buy_num}}</text><text class="item-name">人次</text>
                        </view>
                        <view class="lucky__wrap-info-item"><text class="item-name">获得时间</text><text>{{anonymousState__temp}}</text>
                        </view>
                        <view class="lucky__wrap-info-item"><text class="item-name">购买时间</text><text>{{anonymousState__temp2}}</text>
                        </view>
                    </view>
                    <view class="lucky-code">
                        <view><text class="item-name">幸运码：</text><text class="code-num">{{luckyInfo.lucky_code}}</text>
                        </view>
                        <view class="code-btn" bindtap="handleClickCompute" data-e-tap-so="this">查看计算结果</view>
                    </view>
                </view>
            </block>
            <view class="goods-imgs__wrap">
                <swiper class="goods-imgs__swiper" style="{{'height: ' + windowWidth + 'px'}}" current="{{curImgIdx}}" bindchange="handleSwiperChange" data-e-change-so="this">
                    <swiper-item wx:key="idx" wx:for="{{loopArray0}}" wx:for-item="img" wx:for-index="idx">
                        <image src="{{img.$original}}" mode="aspectFill" style="{{img.$loopState__temp4}}"></image>
                    </swiper-item>
                </swiper>
                <block wx:if="{{imgs.length > 1}}"><text class="goods-imgs__text">{{curImgIdx + 1}}/ {{imgs.length}}</text>
                </block>
            </view>
            <view class="goods-hd">
                <view class="goods-title__wrap"><text class="goods-title">{{info.goods_info.itemName}}</text>
                    <view class="goods-prices">价值：
                        <price primary="{{true}}" __triggerObserer="{{ _triggerObserer }}" noSymbol="{{true}}" noDecimal="{{true}}" appendText="积分" value="{{info.luckydraw_point}}"></price>
                    </view>
                    <block wx:if="{{info.open_status !== 'success'}}">
                        <progress stroke-width="{{6}}" percent="{{rate}}" show-info="{{true}}" activeColor="#C40000"></progress>
                    </block>
                </view>
                <block>
                    <block wx:if="{{info.open_status === 'success'}}">
                        <view class="person-num__wrap">
                            <button disabled="{{info.open_status === 'success' ? true : false}}" class="goods-buy-toolbar__btn btn-fast-buy">本期已揭晓</button>
                        </view>
                    </block>
                    <block wx:else>
                        <view class="person-num__wrap">
                            <view class="person-num"><text>{{info.sales_num}}</text><text>已参与</text>
                            </view>
                            <view class="person-num"><text>{{info.luckydraw_store}}</text><text>总需人次</text>
                            </view>
                            <view class="person-num"><text>{{info.luckydraw_store - info.sales_num}}</text><text>剩余</text>
                            </view>
                        </view>
                    </block>
                </block>
            </view>
            <view class="point-record__wrap">
                <block wx:if="{{isLucky}}">
                    <sp-cell title="中奖订单信息" __triggerObserer="{{ _triggerObserer }}" isLink="{{true}}" bindonclick="handleClickToOrder" __fn_onClick="{{true}}" data-e-onclick-so="this"></sp-cell>
                </block>
                <block wx:if="{{isLogin}}">
                    <sp-cell title="我的记录" __triggerObserer="{{ _triggerObserer }}" isLink="{{true}}" bindonclick="handleClickMyRecord" __fn_onClick="{{true}}" data-e-onclick-so="this"><text class="text-value">已参与{{totalRecord}}次</text>
                    </sp-cell>
                </block>
                <sp-cell title="所有参与记录" __triggerObserer="{{ _triggerObserer }}" isLink="{{true}}" bindonclick="handleClickAllRecord" __fn_onClick="{{true}}" data-e-onclick-so="this"></sp-cell>
                <sp-cell title="图文详情" __triggerObserer="{{ _triggerObserer }}" value="（建议Wifi下使用）" bindonclick="handleClickShowDesc" __fn_onClick="{{true}}" data-e-onclick-so="this"></sp-cell>
            </view>
            <block wx:if="{{isShowDesc}}">
                <view>
                    <view class="sec goods-sec-props">
                        <view class="sec-hd"><text class="sec-title">商品参数</text>
                        </view>
                        <view class="sec-bd">
                            <view class="goods-props__wrap">
                                <view class="prop-item"><text class="prop-item__label">品牌：</text><text class="prop-item__cont">{{info.goods_info.goods_brand || '--'}}</text>
                                </view>
                                <view class="prop-item"><text class="prop-item__label">颜色：</text><text class="prop-item__cont">{{info.goods_info.goods_color || '--'}}</text>
                                </view>
                                <view class="prop-item"><text class="prop-item__label">功能：</text><text class="prop-item__cont">{{info.goods_info.goods_function || '--'}}</text>
                                </view>
                                <view class="prop-item"><text class="prop-item__label">材质：</text><text class="prop-item__cont">{{info.goods_info.goods_series || '--'}}</text>
                                </view>
                            </view>
                        </view>
                    </view>
                    <view class="goods-sec-detail">
                        <at-divider content="宝贝详情" __triggerObserer="{{ _triggerObserer }}"></at-divider>
                        <sp-html-content className="goods-detail__content" __triggerObserer="{{ _triggerObserer }}" content="{{intro}}"></sp-html-content>
                    </view>
                </view>
            </block>
        </scroll-view>
        <back-to-top bottom="{{150}}" __triggerObserer="{{ _triggerObserer }}" show="{{showBackToTop}}" bindonclick="scrollBackToTop" __fn_onClick="{{true}}"></back-to-top>
        <block wx:if="{{info.open_status !== 'success'}}">
            <view class="goods-buy-toolbar">
                <view class="goods-buy-toolbar__btns">
                    <button disabled="{{isBuyBtnDisabled || isDisabled}}" class="goods-buy-toolbar__btn btn-fast-buy" bindtap="handleBuyClick" data-e-tap-so="this">立即抽奖</button>
                </view>
            </view>
        </block>
        <sp-toast __triggerObserer="{{ _triggerObserer }}"></sp-toast>
    </view>
</block>