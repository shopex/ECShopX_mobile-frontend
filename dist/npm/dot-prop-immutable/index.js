"use strict";function set(r,e,t){e="number"==typeof e?propToArray(e.toString()):"string"==typeof e?propToArray(e):e;var i=function(r,e,t,n){var o,a=e[n];return e.length>n?((o=Array.isArray(r)?(a=getArrayIndex(a,r),r.slice()):Object.assign({},r))[a]=i(void 0!==r[a]?r[a]:{},e,t,n+1),o):"function"==typeof t?t(r):t};return i(r,e,t,0)}function get(r,e,t){e="number"==typeof e?propToArray(e.toString()):"string"==typeof e?propToArray(e):e;for(var n=0;n<e.length;n++){if("object"!=typeof r)return t;var o=e[n];Array.isArray(r)&&"$end"===o&&(o=r.length-1),r=r[o]}return void 0===r?t:r}function _delete(r,e){e="number"==typeof e?propToArray(e.toString()):"string"==typeof e?propToArray(e):e;var a=function(r,e,t){var n,o=e[t];return"object"!=typeof r||!Array.isArray(r)&&void 0===r[o]?r:(e.length-1>t?(n=Array.isArray(r)?(o=getArrayIndex(o,r),r.slice()):Object.assign({},r))[o]=a(r[o],e,t+1):Array.isArray(r)?(o=getArrayIndex(o,r),n=[].concat(r.slice(0,o),r.slice(o+1))):delete(n=Object.assign({},r))[o],n)};return a(r,e,0)}function toggle(r,e){var t=get(r,e);return set(r,e,!Boolean(t))}function merge(r,e,t){var n=get(r,e);return"object"!=typeof n?void 0===n?set(r,e,t):r:Array.isArray(n)?set(r,e,n.concat(t)):set(r,e,null===n?t:Object.assign({},n,t))}function getArrayIndex(r,e){if("$end"===r&&(r=Math.max(e.length-1,0)),!/^\+?\d+$/.test(r))throw new Error("Array index '"+r+"' has to be an integer");return parseInt(r)}function propToArray(r){return r.split(".").reduce(function(r,e,t,n){var o=0<t&&n[t-1];return o&&/(?:^|[^\\])\\$/.test(o)?(r.pop(),r.push(o.slice(0,-1)+"."+e)):r.push(e),r},[])}module.exports={set:set,get:get,delete:_delete,toggle:toggle,merge:merge};