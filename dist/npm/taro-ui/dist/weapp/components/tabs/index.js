"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function e(t,n,i){null===t&&(t=Function.prototype);var l=Object.getOwnPropertyDescriptor(t,n);if(void 0===l){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in l)return l.value;var o=l.get;return void 0!==o?o.call(i):void 0},_index=require("../../../../../@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../../../../prop-types/index.js"),_index4=_interopRequireDefault(_index3),_index5=require("../../../../../classnames/index.js"),_index6=_interopRequireDefault(_index5),_utils=require("../../common/utils.js"),_component=require("../../common/component.js"),_component2=_interopRequireDefault(_component);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ENV=_index2.default.getEnv(),AtTabs=(_temp2=_class=function(e){function o(){var e,t,i;_classCallCheck(this,o);for(var n=arguments.length,l=Array(n),a=0;a<n;a++)l[a]=arguments[a];return(t=i=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(l)))).$usedState=["anonymousState__temp","anonymousState__temp2","anonymousState__temp3","anonymousState__temp4","loopArray0","tabList","rootCls","scroll","_tabId","scrollX","scrollY","_scrollLeft","_scrollTop","_scrollIntoView","__fn_onClick","swipeable","tabDirection","current","customStyle","className","height","animated","children"],i.updateState=function(e){if(i.props.scroll)switch(ENV){case _index2.default.ENV_TYPE.WEAPP:case _index2.default.ENV_TYPE.ALIPAY:case _index2.default.ENV_TYPE.SWAN:i.setState({_scrollIntoView:"tab"+(e-1)});break;case _index2.default.ENV_TYPE.WEB:var t=Math.max(e-1,0),n=i.tabHeaderRef.childNodes[t];i.setState({_scrollTop:n.offsetTop,_scrollLeft:n.offsetLeft});break;default:console.warn("AtTab 组件在该环境还未适配")}},i.$$refs=[],_possibleConstructorReturn(i,t)}return _inherits(o,_component2.default),_createClass(o,[{key:"_constructor",value:function(){_get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"_constructor",this).apply(this,arguments),this.state={_scrollLeft:"",_scrollTop:"",_scrollIntoView:""},this._tabId=(0,_utils.isTest)()?"tabs-AOTU2018":(0,_utils.uuid)(),this._touchDot=0,this._timer=null,this._interval=0,this._isMoving=!1}},{key:"handleClick",value:function(){this.__triggerPropsFn("onClick",[null].concat([].concat(Array.prototype.slice.call(arguments))))}},{key:"handleTouchStart",value:function(e){var t=this,n=this.props,i=n.swipeable,l=n.tabDirection;i&&"vertical"!==l&&(this._touchDot=e.touches[0].pageX,this._timer=setInterval(function(){t._interval++},100))}},{key:"handleTouchMove",value:function(e){var t=this.props,n=t.swipeable,i=t.tabDirection,l=t.current,a=t.tabList;if(n&&"vertical"!==i){var o=e.touches[0].pageX-this._touchDot,r=a.length;!this._isMoving&&this._interval<10&&(l+1<r&&o<=-40?(this._isMoving=!0,this.handleClick(l+1)):0<=l-1&&40<=o&&(this._isMoving=!0,this.handleClick(l-1)))}}},{key:"handleTouchEnd",value:function(){var e=this.props,t=e.swipeable,n=e.tabDirection;t&&"vertical"!==n&&(clearInterval(this._timer),this._interval=0,this._isMoving=!1)}},{key:"componentWillReceiveProps",value:function(e){e.scroll!==this.props.scroll&&this.getTabHeaderRef(),e.current!==this.props.current&&this.updateState(e.current)}},{key:"getTabHeaderRef",value:function(){ENV===_index2.default.ENV_TYPE.WEB&&(this.tabHeaderRef=document.getElementById(this._tabId))}},{key:"componentDidMount",value:function(){this.getTabHeaderRef(),this.updateState(this.props.current)}},{key:"componentWillUnmount",value:function(){this.tabHeaderRef=null}},{key:"_createData",value:function(){var e;this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var t=this._tabId,n=this.__props,i=n.customStyle,l=n.className,a=n.height,o=n.tabDirection,r=n.animated,s=n.tabList,u=n.scroll,c=n.current,_=this.__state,p=(_._scrollLeft,_._scrollTop,_._scrollIntoView,{height:a}),d={height:"vertical"===o?100*s.length+"%":"1PX",width:"horizontal"===o?100*s.length+"%":"1PX"},f={},h="translate3d(0px, -"+100*c+"%, 0px)";"horizontal"===o&&(h="translate3d(-"+100*c+"%, 0px, 0px)"),Object.assign(f,{transform:h,"-webkit-transform":h}),r||(f.transition="unset");var b=(0,_index6.default)((_defineProperty(e={"at-tabs":!0,"at-tabs--scroll":u},"at-tabs--"+o,!0),_defineProperty(e,"at-tabs--"+ENV,!0),e),l),y="horizontal"===o,m="vertical"===o,v=(0,_index.internal_inline_style)(this.mergeStyle(p,i)),x=u?(0,_index.internal_inline_style)(p):null,g=(0,_index.internal_inline_style)(this.mergeStyle(f,p)),T=(0,_index.internal_inline_style)(d),w=s.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{itemCls:(0,_index6.default)({"at-tabs__item":!0,"at-tabs__item--active":c===t}),$original:e.$original}});return Object.assign(this.__state,{anonymousState__temp:v,anonymousState__temp2:x,anonymousState__temp3:g,anonymousState__temp4:T,loopArray0:w,tabList:s,rootCls:b,scroll:u,_tabId:t,scrollX:y,scrollY:m}),this.__state}}]),o}(),_class.properties={scroll:{type:null,value:null},__fn_onClick:{type:null,value:null},swipeable:{type:null,value:null},tabDirection:{type:null,value:null},current:{type:null,value:null},tabList:{type:null,value:null},customStyle:{type:null,value:null},className:{type:null,value:null},height:{type:null,value:null},animated:{type:null,value:null}},_class.$$events=["handleClick","handleTouchStart","handleTouchEnd","handleTouchMove"],_temp2);AtTabs.defaultProps={isTest:!1,customStyle:"",className:"",tabDirection:"horizontal",height:"",current:0,swipeable:!0,scroll:!1,animated:!0,tabList:[],onClick:function(){}},AtTabs.propTypes={customStyle:_index4.default.oneOfType([_index4.default.object,_index4.default.string]),className:_index4.default.oneOfType([_index4.default.array,_index4.default.string]),isTest:_index4.default.bool,height:_index4.default.string,tabDirection:_index4.default.oneOf(["horizontal","vertical"]),current:_index4.default.number,swipeable:_index4.default.bool,scroll:_index4.default.bool,animated:_index4.default.bool,tabList:_index4.default.array,onClick:_index4.default.func},exports.default=AtTabs,Component(require("../../../../../@tarojs/taro-weapp/index.js").default.createComponent(AtTabs));