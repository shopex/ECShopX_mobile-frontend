(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"465":function(e,t,a){},"592":function(e,t,a){"use strict";a.r(t);var n,r=a(2),o=a.n(r),i=a(3),s=a.n(i),l=a(613),c=a(216),u=a(569),m=a(217),h=a(44),p=a(609),d=a(564),f=a(562),g=a(347),b=a(27),v=a(8),k=a(28),y=(a(465),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}),_=function(){function defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}();function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){return function step(n,r){try{var o=t[n](r),i=o.value}catch(e){return void a(e)}if(!o.done)return Promise.resolve(i).then(function(e){step("next",e)},function(e){step("throw",e)});e(i)}("next")})}}t.default=Object(h.connect)(function(e){return{"land_params":e.user.land_params}},function(){return{}})(n=function(e){function Reg(e){var t=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Reg);var a,n,r=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Reg.__proto__||Object.getPrototypeOf(Reg)).call(this,e));return r.handleClickImgcode=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var e,a;return regeneratorRuntime.wrap(function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return e={"type":"sign"},t.prev=1,t.next=4,k.a.user.regImg(e);case 4:a=t.sent,r.setState({"imgInfo":a}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),console.log(t.t0);case 11:case"end":return t.stop()}},_callee,t,[[1,8]])})),r.handleSubmit=(a=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(e){var a,n,i;return regeneratorRuntime.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.detail.value,(n=y({},r.state.info,a)).mobile&&/1\d{10}/.test(n.mobile)){t.next=4;break}return t.abrupt("return",v.a.toast("请输入正确的手机号"));case 4:if(n.vcode){t.next=6;break}return t.abrupt("return",v.a.toast("请输入验证码"));case 6:if(n.password){t.next=8;break}return t.abrupt("return",v.a.toast("请输入密码"));case 8:return r.state.list.map(function(e){return e.is_required?!(!e.is_required||!n[e.key])||v.a.toast("请输入"+e.name):null}),t.prev=9,t.next=12,k.a.user.reg(n);case 12:i=t.sent,console.log(i.token.data.token),v.a.setAuthToken(i.token.data.token),o.a.showToast({"title":"注册成功","icon":"none"}),setTimeout(function(){o.a.redirectTo({"url":"/pages/member/index"})},700),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(9),console.log(t.t0);case 22:case"end":return t.stop()}},_callee2,t,[[9,19]])})),function(e){return a.apply(this,arguments)}),r.handleChange=function(e,t){var a=r.state,n=a.info,o=a.list;n[e]=t,"mobile"===e&&11===t.length&&0===r.count&&(r.count=1,r.setState({"imgVisible":!0})),Object(b.h)(t)?o.map(function(a){a.key===e&&(a.value=t)}):o.map(function(a){a.key===e&&(n[e]=t.detail.value),"birthday"===e?a.key===e&&(a.value=t.detail.value):a.key===e&&(a.items?a.value=a.items[t.detail.value]:a.value=t.detail.value)}),r.setState({"list":o}),"sex"===e&&("男"===n[e]?n[e]=1:n[e]=2)},r.handleClickIconpwd=function(){var e=r.state.isVisible;r.setState({"isVisible":!e})},r.handleErrorToastClose=function(){v.a.closeToast()},r.handleTimerStart=(n=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(e){var a,n,o,i,s;return regeneratorRuntime.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:if(!r.state.isTimerStart){t.next=2;break}return t.abrupt("return");case 2:if(a=r.state.info,n=a.mobile,o=a.yzm,i=r.state.imgInfo,/1\d{10}/.test(n)){t.next=6;break}return t.abrupt("return",v.a.toast("请输入正确的手机号"));case 6:if(11===n.length&&o){t.next=8;break}return t.abrupt("return",v.a.toast("请输入手机号和图形验证码"));case 8:return s={"type":"sign","mobile":n,"yzm":o,"token":i.imageToken},t.prev=9,t.next=12,k.a.user.regSmsCode(s);case 12:v.a.toast("发送成功"),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(9),console.log(t.t0);case 18:e();case 19:case"end":return t.stop()}},_callee3,t,[[9,15]])})),function(e){return n.apply(this,arguments)}),r.handleUpdateTimer=function(e){var t=e+"s";r.setState({"timerMsg":t})},r.handleTimerStop=function(){r.setState({"timerMsg":"重新获取"})},r.handleClickAgreement=function(){console.log("用户协议")},r.state={"info":{},"timerMsg":"获取验证码","isVisible":!1,"list":[],"imgVisible":!1,"imgInfo":{}},r}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Reg,r["Component"]),_(Reg,[{"key":"componentDidMount","value":function componentDidMount(){this.setState({"info":{"user_type":"local","uid":this.props.land_params?this.props.land_params.user_id:""}}),this.fetch()}},{"key":"fetch","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var e,t;return regeneratorRuntime.wrap(function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return e=[],a.next=3,k.a.user.regParam();case 3:t=a.sent,Object.keys(t).forEach(function(a){t[a].is_open&&("sex"===a&&(t[a].items=["男","女"]),"birthday"===a&&(t[a].items=[]),e.push({"key":a,"name":t[a].name,"is_required":t[a].is_required,"items":t[a].items?t[a].items:null}))}),this.handleClickImgcode(),this.setState({"list":e}),this.count=0;case 8:case"end":return a.stop()}},_callee4,this)}));return function fetch(){return e.apply(this,arguments)}}()},{"key":"render","value":function render(){var e=this,t=this.state,a=t.info,n=t.timerMsg,r=t.isVisible,o=t.list,i=t.imgVisible,h=t.imgInfo;return s.a.createElement(l.a,{"className":"auth-reg"},s.a.createElement(g.f,{"title":"注册","leftIconType":"chevron-left"}),s.a.createElement(p.a,{"onSubmit":this.handleSubmit},s.a.createElement(l.a,{"className":"sec auth-reg__form"},s.a.createElement(d.a,{"title":"手机号码","name":"mobile","type":"number","maxLength":11,"value":a.mobile,"placeholder":"请输入手机号码","onFocus":this.handleErrorToastClose,"onChange":this.handleChange.bind(this,"mobile")}),i?s.a.createElement(d.a,{"title":"图片验证码","name":"yzm","value":a.yzm,"placeholder":"请输入图片验证码","onFocus":this.handleErrorToastClose,"onChange":this.handleChange.bind(this,"yzm")},s.a.createElement(c.a,{"src":""+h.imageData,"onClick":this.handleClickImgcode})):null,s.a.createElement(d.a,{"title":"验证码","name":"vcode","value":a.vcode,"placeholder":"请输入验证码","onFocus":this.handleErrorToastClose,"onChange":this.handleChange.bind(this,"vcode")},s.a.createElement(g.p,{"onStart":this.handleTimerStart,"onUpdateTimer":this.handleUpdateTimer,"onStop":this.handleTimerStop,"timerMsg":n})),s.a.createElement(d.a,{"title":"密码","name":"password","type":r?"text":"password","value":a.password,"placeholder":"请输入密码","onFocus":this.handleErrorToastClose,"onChange":this.handleChange.bind(this,"password")},r?s.a.createElement(l.a,{"className":"sp-icon sp-icon-yanjing icon-pwd","onClick":this.handleClickIconpwd}," "):s.a.createElement(l.a,{"className":"sp-icon sp-icon-icon6 icon-pwd","onClick":this.handleClickIconpwd}," ")),o.map(function(t,a){return s.a.createElement(l.a,{"key":a},t.items?s.a.createElement(l.a,{"className":"page-section"},s.a.createElement(l.a,{"key":a},"birthday"===t.key?s.a.createElement(u.a,{"mode":"date","onChange":e.handleChange.bind(e,""+t.key)},s.a.createElement(l.a,{"className":"picker"},s.a.createElement(l.a,{"className":"picker__title"},t.name),s.a.createElement(m.a,{"className":Object(b.a)(t.value?"pick-value":"pick-value-null")},t.value?t.value:"请选择"+t.name))):s.a.createElement(u.a,{"mode":"selector","range":t.items,"key":a,"data-item":t,"onChange":e.handleChange.bind(e,""+t.key)},s.a.createElement(l.a,{"className":"picker"},s.a.createElement(l.a,{"className":"picker__title"},t.name),s.a.createElement(m.a,{"className":Object(b.a)(t.value?"pick-value":"pick-value-null")},t.value?t.value:"请选择"+t.name))))):s.a.createElement(l.a,{"key":a},s.a.createElement(d.a,{"key":a,"title":t.name,"name":""+t.key,"placeholder":"请输入"+t.name,"value":t.value,"onFocus":e.handleErrorToastClose,"onChange":e.handleChange.bind(e,""+t.key)})))})),s.a.createElement(l.a,{"className":"btns"},s.a.createElement(f.a,{"type":"primary","onClick":this.handleSubmit,"formType":"submit"},"同意协议并注册"),s.a.createElement(l.a,{"className":"accountAgreement"},"已阅读并同意",s.a.createElement(m.a,{"className":"accountAgreement__text","onClick":this.handleClickAgreement.bind(this)},"《用户协议》")))),s.a.createElement(g.n,null))}},{"key":"componentDidShow","value":function componentDidShow(){}}]),Reg}())||n}}]);