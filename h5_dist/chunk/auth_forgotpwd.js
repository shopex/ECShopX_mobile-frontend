(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{"453":function(e,t,n){},"573":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return b});var r=n(2),a=n.n(r),o=n(3),i=n.n(o),s=n(595),c=n(208),l=n(592),u=n(552),p=n(551),h=n(349),f=n(6),m=n(32),d=(n(453),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),g=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(r,a){try{var o=t[r](a),i=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(i).then(function(e){step("next",e)},function(e){step("throw",e)});e(i)}("next")})}}var b=function(e){function Forgotpwd(e){var t=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Forgotpwd);var n,r,o=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Forgotpwd.__proto__||Object.getPrototypeOf(Forgotpwd)).call(this,e));return o.handleClickImgcode=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var e;return regeneratorRuntime.wrap(function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return e={"type":"forgot_password"},t.next=3,m.a.user.regImg(e).then(function(e){o.setState({"imgInfo":e})});case 3:case"end":return t.stop()}},_callee,t)})),o.handleSubmit=(n=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(e){var n,r;return regeneratorRuntime.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.detail.value,(r=d({},o.state.info,n)).mobile&&/1\d{10}/.test(r.mobile)){t.next=4;break}return t.abrupt("return",f.a.toast("请输入正确的手机号"));case 4:if(r.vcode){t.next=6;break}return t.abrupt("return",f.a.toast("请选择验证码"));case 6:if(r.password){t.next=8;break}return t.abrupt("return",f.a.toast("请输入密码"));case 8:return console.log(r,19),t.prev=9,t.next=12,m.a.user.forgotPwd(r).then(function(){a.a.showToast({"title":"修改成功","icon":"none"}).then(function(){setTimeout(function(){a.a.redirectTo({"url":"/pages/auth/login"})},1500)})});case 12:t.next=18;break;case 14:return t.prev=14,t.t0=t.catch(9),f.a.toast(""+t.t0.res.data.error.message),t.abrupt("return",!1);case 18:case"end":return t.stop()}},_callee2,t,[[9,14]])})),function(e){return n.apply(this,arguments)}),o.handleChange=function(e,t){o.state.info[e]=t,"mobile"===e&&11===t.length&&0===o.count&&(o.count=1,o.setState({"imgVisible":!0}))},o.handleClickIconpwd=function(){var e=o.state.isVisible;o.setState({"isVisible":!e})},o.handleErrorToastClose=function(){f.a.closeToast()},o.handleTimerStart=(r=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(e){var n,r,a,i,s;return regeneratorRuntime.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:if(!o.state.isTimerStart){t.next=2;break}return t.abrupt("return");case 2:if(n=o.state.info,r=n.mobile,a=n.yzm,i=o.state.imgInfo,/1\d{10}/.test(r)){t.next=6;break}return t.abrupt("return",f.a.toast("请输入正确的手机号"));case 6:if(11===r.length&&a){t.next=8;break}return t.abrupt("return",f.a.toast("请输入手机号和图形验证码"));case 8:return s={"type":"forgot_password","mobile":r,"yzm":a,"token":i.imageToken},t.prev=9,t.next=12,m.a.user.regSmsCode(s).then(function(){f.a.toast("发送成功")});case 12:t.next=18;break;case 14:return t.prev=14,t.t0=t.catch(9),f.a.toast(""+t.t0.res.data.error.message),t.abrupt("return",!1);case 18:e();case 19:case"end":return t.stop()}},_callee3,t,[[9,14]])})),function(e){return r.apply(this,arguments)}),o.handleUpdateTimer=function(e){var t=e+"s";o.setState({"timerMsg":t})},o.handleTimerStop=function(){o.setState({"timerMsg":"重新获取"})},o.state={"info":{},"timerMsg":"获取验证码","isVisible":!1,"imgVisible":!1,"imgInfo":{}},o}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Forgotpwd,r["Component"]),g(Forgotpwd,[{"key":"componentDidMount","value":function componentDidMount(){this.fetch()}},{"key":"fetch","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(e){for(;;)switch(e.prev=e.next){case 0:this.handleClickImgcode(),this.count=0;case 2:case"end":return e.stop()}},_callee4,this)}));return function fetch(){return e.apply(this,arguments)}}()},{"key":"render","value":function render(){var e=this.state,t=e.info,n=e.timerMsg,r=e.isVisible,a=e.imgVisible,o=e.imgInfo;return i.a.createElement(s.a,{"className":"auth-forgotpwd"},i.a.createElement(l.a,{"onSubmit":this.handleSubmit},i.a.createElement(s.a,{"className":"sec auth-forgotpwd__form"},i.a.createElement(u.a,{"title":"手机号码","name":"mobile","maxLength":11,"value":t.mobile,"placeholder":"请输入手机号码","onFocus":this.handleErrorToastClose,"onChange":this.handleChange.bind(this,"mobile")}),a?i.a.createElement(u.a,{"title":"图片验证码","name":"yzm","value":t.yzm,"placeholder":"请输入图片验证码","onFocus":this.handleErrorToastClose,"onChange":this.handleChange.bind(this,"yzm")},i.a.createElement(c.a,{"src":""+o.imageData,"onClick":this.handleClickImgcode})):null,i.a.createElement(u.a,{"title":"验证码","name":"vcode","value":t.vcode,"placeholder":"请输入验证码","onFocus":this.handleErrorToastClose,"onChange":this.handleChange.bind(this,"vcode")},i.a.createElement(h.o,{"onStart":this.handleTimerStart,"onUpdateTimer":this.handleUpdateTimer,"onStop":this.handleTimerStop,"timerMsg":n})),i.a.createElement(u.a,{"title":"密码","name":"password","type":r?"text":"password","value":t.password,"placeholder":"请输入密码","onFocus":this.handleErrorToastClose,"onChange":this.handleChange.bind(this,"password")},r?i.a.createElement(s.a,{"className":"sp-icon sp-icon-yanjing icon-pwd","onClick":this.handleClickIconpwd}," "):i.a.createElement(s.a,{"className":"sp-icon sp-icon-icon6 icon-pwd","onClick":this.handleClickIconpwd}," "))),i.a.createElement(s.a,{"className":"btns"},i.a.createElement(p.a,{"type":"primary","onClick":this.handleSubmit,"formType":"submit"},"确认"))),i.a.createElement(h.m,null))}},{"key":"componentDidShow","value":function componentDidShow(){}}]),Forgotpwd}()}}]);